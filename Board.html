<html>
	<head>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
		<script src="https://code.jquery.com/jquery-3.5.0.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
		<style>
			@-o-keyframes fadeIt {
				0% {
					background-color: #ffffff;
				}
				50% {
					background-color: #ad301b;
				}
				100% {
					background-color: #ffffff;
				}
			}
			@keyframes fadeIt {
				0% {
					background-color: #ffffff;
				}
				50% {
					background-color: #ad301b;
				}
				100% {
					background-color: #ffffff;
				}
			}

			.backgroundAnimated {
				background-image: none !important;
				-o-animation: fadeIt 5s ease-in-out;
				animation: fadeIt 5s ease-in-out;
			}

			input {
				width: 100%;
				height: 100%;
				border: none;
				font-size: 20px;
				font-weight: bold;
				text-align: center;
			}
			table {
				border: 2px solid #000;
			}
			td {
				border: 1px solid #000;
				width: 50px;
				height: 50px;
			}
			td:nth-of-type(3n) {
				border-right: 2px solid #000;
			}
			tr:nth-of-type(3n) {
				border-bottom: 2px solid #000;
			}
			td.candidates {
				padding: 0 10px 0 10px;
				font-size: 10px;
			}
			td.candidates input {
				display: none;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="mx-auto mt-5" style="width: 451px;">
				<table>
					<tr id="row_1">
						<td id="cell_1"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_2"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_3"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_4"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_5"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_6"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_7"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_8"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_9"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
					<tr id="row_2">
						<td id="cell_10"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_11"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_12"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_13"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_14"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_15"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_16"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_17"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_18"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
					<tr id="row_4">
						<td id="cell_19"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_20"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_21"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_22"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_23"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_24"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_25"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_26"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_27"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
					<tr id="row_5">
						<td id="cell_28"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_29"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_30"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_31"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_32"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_33"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_34"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_35"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_36"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
					<tr id="row_6">
						<td id="cell_37"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_38"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_39"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_40"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_41"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_42"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_43"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_44"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_45"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
					<tr id="row_7">
						<td id="cell_46"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_47"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_48"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_49"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_50"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_51"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_52"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_53"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_54"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
					<tr id="row_8">
						<td id="cell_55"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_56"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_57"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_58"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_59"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_60"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_61"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_62"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_63"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
					<tr id="row_9">
						<td id="cell_64"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_65"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_66"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_67"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_68"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_69"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_70"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_71"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_72"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
					<tr id="row_10">
						<td id="cell_73"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_74"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_75"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_76"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_77"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_78"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_79"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_80"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
						<td id="cell_81"><span class="candidateList"></span><input type="text" maxlength="1" /></td>
					</tr>
				</table>
				<div class="mt-5">
					<button class="btn btn-success js-start">Start</button>
					<button class="btn btn-danger js-clear">Clear</button>
					<button class="btn btn-success js-solve">Solve</button>
					<button class="btn btn-primary js-step">Step</button>
				</div>
				<div class="mt-2">
					<div class="alert alert-info js-alert" role="alert"></div>
				</div>
			</div>
		</div>
		<script>
			$(".js-clear").click(function () {
				$.each($("input"), function (index, value) {
					$(this).val("");
				});
			});

			//Setup
			//Easy
			//var startBoard = "070000002001805070005400601090006103037000540406100090709002400010504300200000010";
			//Hard
			var startBoard = "001093006023610070000000020900000000005361700000000004080000000090086350100450800";
			$.each($("input"), function (index, value) {
				$(this).attr("tabindex", index + 1);
				$(this).val(startBoard[index]);
				//$(this).val(index);
				$(this).keyup(function (e) {
					if (e.keyCode > 47 && e.keyCode < 59) {
						$(this).val("" + (e.keyCode - 48));
						if ($(this).parent().next().length == 0) {
							$($("input", $(this).parent().parent().next().first("td"))[0]).focus();
						} else {
							$("input", $(this).parent().next()).focus();
						}
					}
				});
			});

			$(".js-start").click(function () {
				var field = [];
				$.each($("input"), function (index, value) {
					field.push($(this).val());
				});
				doSend({ command: "start", field: field });
			});

			$(".js-solve").click(function () {
				doSend({ command: "solve" });
			});

			$(".js-step").click(function () {
				doSend({ command: "step" });
			});

			var startButton = $(".js-start");
			var solveButton = $(".js-solve");
			var stepButton = $(".js-step");
			var wsUri = "ws://127.0.0.1:8080/";
			var websocket = new WebSocket(wsUri);

			this.send = function (message, callback) {
				this.waitForConnection(function () {
					websocket.send(message);
					if (typeof callback !== "undefined") {
						callback();
					}
				}, 1000);
			};

			function doSend(data) {
				this.send(JSON.stringify(data));
			}

			this.waitForConnection = function (callback, interval) {
				if (websocket.readyState === 1) {
					callback();
				} else {
					var that = this;
					// optional: implement backoff for interval here
					setTimeout(function () {
						that.waitForConnection(callback, interval);
					}, interval);
				}
			};

			websocket.onmessage = function (e) {
				var data = JSON.parse(e.data);
				$.each($("input"), function (index, value) {
					var $cell = $("td#cell_" + (index + 1));
					if (data.candidates[index].length == 0 && $(this).val() != data.field[index]) {
						$cell.removeClass("candidates");
						$(this).addClass("backgroundAnimated");
						$(this).val(data.field[index]);
						$(".candidateList", $cell).text("");
					} else if (data.candidates[index].length > 0) {
						$cell.addClass("candidates");
						$(".candidateList", $cell).text(data.candidates[index].join(" "));
					}
				});
			};

			websocket.onopen = function (e) {
				writeToScreen("CONNECTED");
			};

			websocket.onerror = function (e) {
				writeToScreen("Connection error: " + e.data);
			};

			websocket.onclose = function (e) {
				writeToScreen("DISCONNECTED");
			};

			websocket.onopen = function (e) {
				writeToScreen("CONNECTED");
			};

			function writeToScreen(message) {
				$(".js-alert").append("<div>" + message + "</div>");
			}
		</script>
	</body>
</html>
